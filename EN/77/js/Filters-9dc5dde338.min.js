var chlenruslana=1;define(["dom","autocomplete","nouislider","ajax","css!nouislider_css.css"],(function(t,i,e,n){return{init:function(t){this.bind(),this.saveParams(),this.filters=null,this.callback=t},bind:function(){var t=Q(".discovery-filters-button")[0],i=Q(".discovery-filters-button-close")[0],e=Q(".reset-filters")[0];i&&t&&(t.onclick=this.showSettings.bind(this),i.onclick=this.showSettings.bind(this)),e&&(e.onclick=this.resetFilters.bind(this)),this.bindForm()},saveParams:function(){var t=Q("#country")[0],i=Q("#city")[0];t&&i&&(this.initialParams={gender:Q(".set-form .gender").value,ageMin:this.ageMin,ageMax:this.ageMax,countryId:t.getAttribute("data-id"),countryText:t.value,cityId:i.getAttribute("data-id"),cityText:i.value})},showSettings:function(t){t&&(t.preventDefault(),t.stopPropagation());var i=Q(".discovery-settings")[0],e=parseInt(i.style.top,10);isNaN(e)||100===e?i.style.top=0:i.style.top="100%"},bindForm:function(){var t=this,i=Q(".data-switch li");[].forEach.call(i,(function(i){i.onclick=t.selectGender.bind(t)})),this.applyButton(),this.initAgeSlider(),this.parseLocation(),this.bindAutocomplete()},selectGender:function(i){i.preventDefault(),i.stopPropagation();var e=Q(".gender")[0],n=i.currentTarget,a=n.getAttribute("data-gender"),r=t.classList(),s=Q(".data-switch li");t.removeClass(s,"active"),r.add(n,"active"),e.value=a},bindAutocomplete:function(){new i({selector:"#country",minLength:2,templateSelector:"#autocomplete-list-template",listSelector:".list-for-countries",callback:this.renderComplete.bind(this),onchange:this.countryChangeCallback.bind(this)}),this.cityAutocmplete=new i({selector:"#city",minLength:2,templateSelector:"#autocomplete-list-template",listSelector:".list-for-cities",queryArgs:{country:this.countryId},callback:this.renderComplete.bind(this),onchange:this.cityChangeCallback.bind(this)})},renderComplete:function(){var t=this,i=Q(".list-for-countries li, .list-for-cities li");[].forEach.call(i,(function(i){i.onclick=t.select.bind(t)}))},select:function(i){i.stopPropagation(),i.preventDefault();var e,n=t.classList(),a=i.currentTarget||i.target,r=a.parentNode,s=a.getAttribute("data-id"),c=Q(".city")[0];if(n.contains(r,"list-for-countries")){if(e=Q("#country")[0],this.countryId=s,0==this.countryId)return void(Q("#country")[0].value="");this.cityAutocmplete.updateOptions({queryArgs:{country:this.countryId}}),n.remove(c,"hide"),Q("#city")[0].value="",this.cityId=null}else e=Q("#city")[0],this.cityId=s;var o=a.textContent.trim();e.value=o,r.innerHTML="",this.toggleError()},countryChangeCallback:function(){var t=Q("#country")[0],i=Q(".row.city")[0];t.value||(this.cityId=null,i.className+=" hide",i.value="")},cityChangeCallback:function(){var t=Q("#city")[0];t.value||(this.cityId=null)},parseLocation:function(){var i=Q("#country")[0],e=Q("#city")[0];if(i&&e&&(this.countryId=i.getAttribute("data-id"),e.value)){var n=t.getParents(e),a=t.classList();this.cityId=e.getAttribute("data-id"),[].some.call(n,(function(t){if(a.contains(t,"city"))return a.remove(t,"hide"),!0}))}},applyButton:function(){var t=this,i=Q(".apply-filters")[0];i&&(i.onclick=function(i){i.preventDefault(),t.filters=t.getData(),t.getUsers()})},getUsers:function(){return this.filters.city_id&&this.filters.country_id?(n.get("/",{filters:this.filters},this.callback),this.showSettings(),void this.toggleError()):this.toggleError()},toggleError:function(){var t=Q(".discovery-settings .error")[0];t&&(!this.filters||this.filters.city_id&&this.filters.country_id?t.style.display="none":t.style.display="block")},getData:function(){return{country_id:this.countryId,city_id:this.cityId,age_start:this.ageMin,age_end:this.ageMax,gender:Q(".gender")[0].value}},initAgeSlider:function(){var t=this,i=document.getElementById("age-range");if(i){var n=+i.getAttribute("data-age-min")||18,a=+i.getAttribute("data-age-max")||80;i.noUiSlider&&i.noUiSlider.destroy(),e.create(i,{start:[n,a],range:{min:[18],max:[80]}}),i.noUiSlider.on("update",(function(i){t.ageMin=Math.floor(i[0]),t.ageMax=Math.floor(i[1]),t.setAge()}))}},setAge:function(){var t=document.querySelector(".selected-age span");t&&(t.textContent=this.ageMin+" - "+this.ageMax)},resetFilters:function(){var t=this;"f"===this.initialParams.gender?Q(".data-switch .m")[0].click():Q(".data-switch .f")[0].click();var i=document.getElementById("age-range");i.noUiSlider&&i.noUiSlider.set([this.initialParams.ageMin,this.initialParams.ageMax]);var e=Q(".list-for-countries")[0];e.innerHTML="";var n=Q(".list-for-cities")[0];n.innerHTML="";var a=Q("#country")[0];a.value=this.initialParams.countryText,a.setAttribute("data-id",this.initialParams.countryId);var r=Q("#city")[0];r.value=this.initialParams.cityText,r.setAttribute("data-id",this.initialParams.cityId),this.parseLocation(),this.cityAutocmplete.updateOptions({queryArgs:{country:this.countryId}}),setTimeout((function(){t.filters=t.getData(),t.getUsers()}),1e3)}}}));
//# sourceMappingURL=Filters-9dc5dde338.min.js.map
