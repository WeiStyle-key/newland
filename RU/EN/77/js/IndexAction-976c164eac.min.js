function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var chlenruslana=1;define(["banners","dom","location","ajax","page","hammer","Filters","analitics"],(function(e,t,i,s,r,n,o,a){var c=(function(){function c(){_classCallCheck(this,c);var e=this.discovery=Q(".discovery")[0];e&&(this.clicks=0,App.tagsCounter="undefined"==typeof App.tagsCounter?0:App.tagsCounter,this.init())}return c.prototype.init=function(){var e=Q(".discovery img")[0],t=e.src||e.getAttribute("data-image-preload");this.users=[],this.click=0,this.tagSending=!1,this.page=new r,this.loadImage(e,t),this.injectFirstUser(),this.bindButtons(),this.setHeight(),o.init(this.filtersCallback.bind(this));var i=document.querySelectorAll(".btn-get-num");i&&App.context.ak===!1&&(document.querySelector("#try-get-number-index").style.display="none"),i&&Array.prototype.forEach.call(i,(function(e){e.addEventListener("click",(function t(r){if(App.context.ak&&!App.context.smsDisabled){var n="sms:+17855719308?&body=My code "+App.context.ak+". I want to chat and receive sms notifications when sbm wrote me.";"ios"==App.context.browser.platform?window.open(n):location.href=n,Array.prototype.forEach.call(i,(function(e){e.classList.remove("btn-get-num"),e.removeEventListener("click",t)}));var o=document.querySelector("#try-get-number-index");o&&(o.classList.add("disabled"),o.style.display="none");var a=e.classList.contains("like")?"disclike":"discmsg";App.context.smsDisabled=!0,s.post("messages/track_get_num",{user_id:App.context.userId,extraction_type:"1",extraction_zone:a})}}))}))},c.prototype.injectFirstUser=function(){var e=document.getElementById("ratedUser");if(e&&e.value){var t;try{t=JSON.parse(e.value),this.users=this.users.concat(t),this.currentUser=t,this.page.updateHeader({userName:this.currentUser.n,online:this.currentUser.o,status_icon:this.currentUser.status_icon?this.currentUser.status_icon:{}})}catch(i){console.error(i)}}},c.prototype.setHeight=function(){var i=window.innerHeight,s=Q("#header")[0],r=Q("#content-holder")[0];if(r){var n=getComputedStyle(s).height;if(n=parseInt(n,10)+(t.offsetHeight(Q(".zaceni-top-banner")[0])||0),App.zaceniSplit)r.style.height=i-n-20+"px",r.style.marginBottom="50px";else{var o=e.getVisibleBanners(e.fixed);o=o.length?50:0,r.style.height=i-n-o+"px"}}},c.prototype.bindSwipe=function(){var e=Q(".profile_link img")[0];if(e){var t=new n(e);t.off("swipeleft").on("swipeleft",(function(){Q(".button.next")[0].click()}))}},c.prototype.refreshBanner=function(){},c.prototype.spinner=function(){var e=t.classList(),i=Q(".main-photo")[0];return{show:function(){e.add(i,"loading")},hide:function(){e.remove(i,"loading")}}},c.prototype.updateLikeButton=function(){var e=Q(".button.like")[0],i=t.classList();e&&(this.tagSending?i.add(e,"disable"):i.remove(e,"disable"))},c.prototype.bindButtons=function(){function e(e){var t=e.target;t.className=t.className.replace(" pulse",""),t.className.indexOf("prev")>=0&&(t.style.display="none")}var r=Q(".discovery .buttons")[0],n=this;r.onclick=function(o){var c=o.target;for(o.preventDefault();c&&c!==r;){var p=c.className;if(p&&p.indexOf){if(~p.indexOf("next")){c.className+=" pulse",t.onetime(c,"webkitAnimationEnd animationend",e),n.skipUser(c);break}if(~p.indexOf("like")){c.className+=" pulse",t.onetime(c,"webkitAnimationEnd animationend",e),n.likeUser(c);break}if(~p.indexOf("prev")){n.prevUser(c);break}if(~p.indexOf("msg")){t.onetime(c,"webkitAnimationEnd animationend",e),n.currentUser&&n.currentUser.uid?(i.parseHref(null,"/thread"+n.currentUser.uid),a.track("smart","GO TO THREAD FROM SYMPATHY"),s.post("/",{thread:n.currentUser.uid})):i.parseHref(null,"/messages");break}}c=c.parentNode}},t.showAll(Q(".button.like, .button.next, .button.msg"),"inline-block"),this.bindSwipe()},c.prototype.getUsers=function(){if(!this.loadUsers){this.loadUsers=!0;var e;e=o.filters?{filters:o.filters}:{get_new_users:1},s.get("/",e,this.getUsersCallback.bind(this))}},c.prototype.getUsersCallback=function(e){if(!e||!e.length)return location.reload();var t=this.users.length-2;t>2&&(this.users.splice(0,t),this.click=this.click-t),188414822===App.context.userId&&(e[0].p="http://vlastelin.mira/1.png"),this.users=this.users.concat(e),this.loadUsers=!1,this.showUser()},c.prototype.showUser=function(){this.clicks++,this.spinner().show();var e=this.users[this.click];return e?(this.prepareNewUser(e),void window.scrollTo(0,this.top)):this.getUsers()},c.prototype.prepareNewUser=function(e){var i=[Q(".main-photo")[0],Q(".discovery img")[0],Q(".count")[0],Q(".discovery .profile_link")],s=i[0],r=i[1],n=i[2],o=i[3];if(s&&r&&n){this.loadImage(r,e.p),n.innerHTML=e.ph||0,s.setAttribute("data-user-id",e.uid),t.updateAttr(o,"href","/u"+e.uid),Q(".discovery")[0].setAttribute("data-user-id",e.uid),Q(".button.like")[0].setAttribute("data-tag-gender",e.g);var a=Q(".count-holder.video")[0];a&&(a.style.display="none"),this.page.data=null,this.page.updateHeader({userName:e.n,online:e.o,status_icon:this.currentUser.status_icon?this.currentUser.status_icon:{}}),this.currentUser=e,this.updatePrevButton()}},c.prototype.updatePrevButton=function(){var e=Q(".buttons .prev")[0];e&&(e.style.display=this.showPrevButton&&!this.prevButtonClicked?"inline-block":"none")},c.prototype.loadImage=function(e,t){var i=this;if(e&&t){if(e.src=t,e.complete)return this.spinner().hide();e.onload=function(){i.spinner().hide()},e.onerror=function(){i.users.splice(i.click,1),i.skipUser(Q(".button.next")[0])}}},c.prototype.skipUser=function(){var e=this,t=i.getUrl();0!==t.indexOf("/?people")&&this.refreshBanner(),this.loadUsers||this.currentUser&&this.currentUser.uid&&(this.top=window.pageYOffset,this.prevButtonClicked?this.skipUserReponce():s.post("/",{skipped_id:e.currentUser.uid},this.skipUserReponce.bind(this)))},c.prototype.skipUserReponce=function(){var e=i.getUrl();0!==e.indexOf("/?people")&&(this.click++,this.showPrevButton=!0,this.prevButtonClicked=!1,this.showUser(),App.tagsCounter++,this.loadFrame()),this.responeCallback("skip")},c.prototype.likeUser=function(){var e=this,r=i.getUrl(),n=this;this.loadUsers||this.tagSending||this.currentUser&&this.currentUser.uid&&(this.top=window.pageYOffset,s.post("/",{liked_id:this.currentUser.uid,remove_skipped_id:(function(){var e=t.isVisible(Q(".button.prev")[0]);return!e&&n.prevButtonClicked?n.currentUser.uid:null})()},(function(){if(0!==r.indexOf("/?people")&&(e.click++,e.showPrevButton=!1,e.prevButtonClicked=!1,e.showUser(),e.updateLikeButton(),App.tagsCounter++,e.loadFrame()),0===r.indexOf("/?people")&&e.currentUser){var t="/thread"+e.currentUser.uid;t+="?from_zaceni=1",i.parseHref(null,t)}})))},c.prototype.prevUser=function(){var e=this.users[this.click-1];e&&(this.click=this.click-1,this.prevButtonClicked=!0,this.prepareNewUser(e))},c.prototype.loadFrame=function(){return},c.prototype.responeCallback=function(e){var t=i.getUrl();if(0===t.indexOf("/?people")&&this.currentUser){var s="/thread"+this.currentUser.uid;e||(s+="?from_zaceni=1"),i.parseHref(null,s)}},c.prototype.filtersCallback=function(e){e&&e.length&&(this.loadUsers=!1,this.tagSending=!1,this.showPrevButton=!1,this.prevButtonClicked=!1,this.click=0,this.users=e,this.showUser())},c})();return c}));
//# sourceMappingURL=IndexAction-976c164eac.min.js.map
